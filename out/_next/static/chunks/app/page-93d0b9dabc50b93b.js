(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5369:function(e,t,r){Promise.resolve().then(r.bind(r,3654))},3654:function(e,t,r){"use strict";r.r(t),r.d(t,{S3:function(){return ex},default:function(){return eR}});var n=r(7437),i=r(2265),a=r(8638),o=r(7665);let l=(0,o.cn)({position:(0,a.R3)(),standPosition:(0,a.R3)(),velocity:(0,a.R3)(),reverseVelocity:(0,a.R3)(),quat:(0,a.gf)(),euler:(0,a.bp)(),dir:(0,a.R3)(),direction:(0,a.R3)(),refs:{}});l.debugPrivate=!0;let s=(0,o.cn)({debug:!1,mode:"normal",controllerType:"none",cameraCollisionType:"transparent",camera:{type:"orthographic",control:"orbit"},minimap:!0,minimapRatio:1,perspectiveCamera:{isFront:!0,XZDistance:8,YDistance:1},orthographicCamera:{zoom:1,near:.1,far:1e3}});s.debugLabel="options";var c=r(6375);function u(e,t){return e?t:new c.Vector3(0,0,0)}function d(e,t,r){return new c.Vector3(e,t,r)}var m=r(3957),g=r(6701),p=r(9642),h=r(8034),y=r(3890);function f(e){let{prop:t}=e,r=(0,y.Dv)(s),{rigidBodyRef:o,outerGroupRef:u,cameraRay:f,constant:v}=t,x=(0,y.Dv)(l),{checkCollision:R}=function(e){let{cameraRay:t,constant:r,options:n}=e,{camera:i}=(0,h.A)();return{checkCollision:e=>{t.origin.copy(t.pivot.position),i.getWorldPosition(t.position),t.dir.subVectors(t.position,t.pivot.position),t.intersects=t.rayCast.intersectObjects(Object.values(t.intersectObjectMap)),t.intersects.length&&t.intersects[0].distance<=-r.cameraInitDistance?"transparent"===n.cameraCollisionType?(t.intersetesAndTransParented=[...t.intersects],t.intersetesAndTransParented.map(e=>{let t=e.object,r=t.material;r.opacity=.2,r.transparent=!0})):"closeUp"===n.cameraCollisionType&&(r.cameraMinDistance=-t.intersects[0].distance*r.cameraCollisionOff<-.7?-t.intersects[0].distance*r.cameraCollisionOff:-.7):("transparent"===n.cameraCollisionType&&(t.intersetesAndTransParented.map(e=>{let t=e.object,r=t.material;r.opacity=1,r.transparent=!1}),t.intersetesAndTransParented=[]),r.cameraMinDistance=r.cameraInitDistance),t.lerpingPoint.set(t.followCamera.position.x,r.cameraMinDistance*Math.sin(-t.followCamera.rotation.x),r.cameraMinDistance*Math.cos(-t.followCamera.rotation.x)),t.followCamera.position.lerp(t.lerpingPoint,4*e)}}}(t),{camera:b}=(0,h.A)();return(0,i.useEffect)(()=>{let e=new c.Object3D;e.position.set(0,0,v.cameraInitDirection),f.followCamera=e},[]),(0,h.C)((e,t)=>{if(!o||!o.current||!u||!u.current)return null;if("perspective"===r.camera.type){if("orbit"===r.camera.control){let t=d(Math.sin(x.euler.y),0,Math.cos(x.euler.y)).normalize(),n=(0,a.R3)(o.current.translation()).clone().add(t.clone().multiplyScalar(r.perspectiveCamera.XZDistance).multiplyScalar(r.perspectiveCamera.isFront?-1:1).add(d(0,r.perspectiveCamera.YDistance,0)));e.camera.position.lerp(n,.2),e.camera.quaternion.copy(x.quat.clone().multiply(r.perspectiveCamera.isFront?(0,a.gf)().setFromAxisAngle(d(0,1,0),Math.PI):(0,a.gf)())),e.camera.lookAt((0,a.R3)(o.current.translation()))}else"normal"===r.camera.control&&(f.pivot.position.lerp(x.position,1-Math.exp(-v.cameraCamFollow*t)),e.camera.position.set(0,0,0),e.camera.lookAt(f.pivot.position),R(t))}else"orthographic"===r.camera.type&&b.position.set(-10,10,-10).add((0,a.R3)(o.current.translation()))}),(0,n.jsxs)(n.Fragment,{children:["perspective"===r.camera.type&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(m.c,{makeDefault:!0,...r.perspectiveCamera})}),"orthographic"===r.camera.type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.z,{target:x.position,enableZoom:!1,enablePan:!0,zoomSpeed:.3}),(0,n.jsx)(p.i,{makeDefault:!0,...r.orthographicCamera})]})]})}let v=(0,o.cn)({isMoving:!1,isNotMoving:!1,isOnTheGround:!1,isOnMoving:!1,isRotated:!1,isRunning:!1,isJumping:!1,isAnimationOuter:!1});v.debugPrivate=!0;let x=(0,o.cn)({forward:!1,backward:!1,leftward:!1,rightward:!1});function R(e){let t=(0,y.Dv)(x),r=(0,y.Dv)(s),{controllerType:n}=r,{keyControl:i}=e;return"gameboy"===n||"joystick"===n?t:i}x.debugLabel="control";let b=(0,o.cn)({x:"50%",y:"50%",position:"absolute",background:"rgba(0, 0, 0, 0.5)",boxShadow:"0 0 10px  rgba(0, 0, 0, 0.5)"}),w=(0,o.cn)({x:0,y:0,angle:Math.PI/2,currentRadius:0,originRadius:0,isIn:!0,isOn:!1});w.debugPrivate=!0,b.debugPrivate=!0;let j=(0,o.cn)({height:.7,halfHeight:.35,radius:.3,diameter:.6});function C(e,t){let[r,n]=(0,y.KO)(j),i=new c.Box3().setFromObject(e),o=null==t?void 0:t.scale,l=i.getSize(new c.Vector3);if(Array.isArray(o)?l.multiply((0,a.R3)({x:o[0],y:o[1],z:o[2]})):"number"==typeof o?l.multiplyScalar(o):l.multiplyScalar(1),0!==l.x&&0!==l.y&&0!==l.z){let e=l.y/2,t=Math.max(l.x,l.z),r=t/2;n({height:e-t/2,halfHeight:e/2-r/2,diameter:t,radius:r})}return{collider:r,setcollider:n}}j.debugLabel="collider";var M=r(492),S=r(6511);let D=(0,i.forwardRef)((e,t)=>{let{controllerProps:r,groundRay:i,children:o}=e,l=(0,y.Dv)(s);return(0,n.jsxs)(a.ib,{colliders:!1,canSleep:!1,ref:t,...r,children:[l.debug&&(0,n.jsx)("mesh",{visible:l.debug,children:(0,n.jsx)("arrowHelper",{args:[i.dir,i.origin,i.length]})}),o]})}),k=(0,i.forwardRef)((e,t)=>{let r=(0,y.Dv)(j);return(0,n.jsx)(a.zm,{ref:t,args:[r.height,r.radius]})}),O=(0,i.forwardRef)((e,t)=>{let{children:r}=e;return(0,n.jsx)("group",{ref:t,userData:{intangible:!0},children:r})}),F=(0,i.forwardRef)((e,t)=>{let{groundRay:r,slopeRay:i}=e,a=(0,y.Dv)(s);return(0,n.jsxs)("mesh",{position:[r.offset.x,r.offset.y,r.offset.z+i.offset.z],ref:t,visible:!1,userData:{intangible:!0},children:[a.debug&&(0,n.jsx)("mesh",{children:(0,n.jsx)("arrowHelper",{args:[i.dir,i.origin,i.length,"#ff0000"]})}),(0,n.jsx)("boxGeometry",{args:[.15,.15,.15]})]})});var I=r(8780);let P=(0,o.cn)({current:"idle",animationNames:{idle:"idle",walk:"walk",run:"run",jump:"jump",jumpIdle:"jumpIdle",jumpLand:"jumpLand",fall:"fall"},keyControl:{}});P.debugLabel="animation";var z=r(4863);let A="";function N(e){let{prop:t,url:r,character:a,groundRay:o,refs:s,callbacks:c}=e;A=r;let u=(0,h.F)(z.E,r),{materials:d,nodes:m,scene:g,animations:p}=u,f=(0,y.Dv)(j);return C(g,a),!function(e){let{prop:t,callbacks:r,animations:n}=e,{outerGroupRef:a,rigidBodyRef:o,slopeRayOriginRef:s,capsuleColliderRef:c}=t,u=(0,y.Dv)(l),d=(0,y.Dv)(v),{actions:m}=(0,I.v)(n,a),[g,p]=(0,y.KO)(P),f=e=>{p(t=>({...t,current:e}))},x=R(t),b={...t,keyControl:x,current:u,states:d};(0,i.useEffect)(()=>{o&&o.current&&(u.refs.rigidBodyRef=o),a&&a.current&&(u.refs.outerGroupRef=a),c&&c.current&&(u.refs.capsuleColliderRef=c),s&&s.current&&(u.refs.slopeRayOriginRef=s)},[]),(0,i.useEffect)(()=>(r&&r.onReady&&r.onReady(b),()=>{r&&r.onDestory&&r.onDestory(b)}),[]),(0,h.C)(e=>{r&&r.onFrame&&r.onFrame({...b,...e}),r&&r.onAnimate&&r.onAnimate({...b,...e,actions:m,animation:g,playAnimation:f})})}({prop:t,callbacks:c,animations:p}),!function(e){let{outerGroupRef:t,groundRay:r,animations:n}=e,{playIdle:a,playWalk:o,playRun:s,playJump:c,playFall:u}=function(e){let{outerGroupRef:t,animations:r}=e,[n,a]=(0,M.Z)(),o=a(),{actions:l}=(0,I.v)(r,t),[s,c]=(0,y.KO)(P);(0,i.useEffect)(()=>{c(e=>({...e,keyControl:o}))},[o]);let u=(0,i.useCallback)(e=>{c(t=>({...t,current:e}))},[c,s,s.current]),d=e=>{c(t=>({...t,animationNames:Object.assign(t.animationNames,Object.keys(e).reduce((e,t)=>({...e,[t]:t}),{}))}))},m=()=>u("idle");return(0,i.useEffect)(()=>()=>{m()},[]),(0,i.useEffect)(()=>{var e;let t=null===(e=l[s.current])||void 0===e?void 0:e.reset().fadeIn(.2).play();return d(l),()=>{null==t||t.fadeOut(.2)}},[s.current]),{current:s.current,setAnimation:c,playAnimation:u,resetAni:m,playIdle:()=>u("idle"),playWalk:()=>u("walk"),playRun:()=>u("run"),playJump:()=>u("jump"),playJumpIdle:()=>u("jumpIdle"),playJumpLand:()=>u("jumpLand"),playFall:()=>u("fall")}}({outerGroupRef:t,animations:n}),d=(0,y.Dv)(v),m=(0,y.Dv)(l),{isNotMoving:g,isMoving:p,isJumping:f,isRunning:x,isAnimationOuter:R}=d;(0,h.C)(()=>{!R&&(f?c():g?a():x?s():p&&o(),null===r.hit&&m.velocity.y<0&&u())})}({outerGroupRef:s.outerGroupRef,groundRay:o,animations:p}),(0,n.jsxs)("group",{receiveShadow:!0,castShadow:!0,...a,position:[0,-f.height,0],children:[(0,n.jsx)("primitive",{object:m.walk,visible:!1,receiveShadow:!0,castShadow:!0}),Object.keys(m).map((e,t)=>{if("SkinnedMesh"===m[e].type)return(0,n.jsx)("skinnedMesh",{castShadow:!0,receiveShadow:!0,material:d[e],geometry:m[e].geometry,skeleton:m[e].skeleton},t)})]})}function K(e){e.url;let t=(0,h.F)(z.E,"/kart.glb"),{materials:r,nodes:i,scene:a}=t,[o,l]=(0,y.KO)(j);return C(a,e.character),(0,n.jsx)(n.Fragment,{children:i&&r&&(0,n.jsx)("group",{receiveShadow:!0,castShadow:!0,children:Object.keys(i).map((e,t)=>{if("Mesh"===i[e].type||"SkinnedMesh"===i[e].type)return(0,n.jsx)("mesh",{castShadow:!0,receiveShadow:!0,material:r[e],geometry:i[e].geometry},t)})})})}function T(e){var t,r;let o=(0,i.useRef)(null),m=(0,i.useRef)(null),g=(0,i.useRef)(null),p=(0,i.useRef)(null),x={capsuleColliderRef:o,rigidBodyRef:m,outerGroupRef:g,slopeRayOriginRef:p},b={...function(e){var t;let{props:r,refs:n}=e,{rapier:o,world:l}=(0,a.dv)(),[u,d]=(0,M.Z)(),m=(0,i.useCallback)(()=>d(),[d])(),[g,p]=(0,y.KO)(s),f=(0,i.useMemo)(()=>({origin:(0,a.R3)(),dir:(0,a.R3)({x:0,y:-1,z:0}),offset:(0,a.R3)({x:0,y:-j.init.halfHeight,z:0}),hit:null,parent:null,rayCast:null,length:j.init.radius+2}),[]);f.rayCast=new o.Ray(f.origin,f.dir),f.hit=l.castRay(f.rayCast,f.length,!0,void 0,void 0,n.capsuleColliderRef.current,void 0),f.parent=null===(t=f.hit)||void 0===t?void 0:t.collider.parent();let v=(0,i.useMemo)(()=>({current:(0,a.R3)(),origin:(0,a.R3)(),hit:null,rayCast:null,dir:(0,a.R3)({x:0,y:-1,z:0}),offset:(0,a.R3)({x:0,y:0,z:j.init.radius-.03}),length:j.init.radius+3,angle:0}),[]);v.rayCast=new o.Ray(v.origin,v.dir);let x=(0,i.useMemo)(()=>({velocity:(0,a.R3)(),direction:(0,a.R3)()}),[]),R=(0,i.useMemo)(()=>({jumpSpeed:5,jumpAccelY:5,turnSpeed:10,rejectSpeed:4,splintSpeed:3,runRate:2,dT:10,reconsil:.3,rotational:.03,vertical:.02,airDamping:.2,springConstant:1.2,cameraInitDistance:-5,cameraMaxDistance:-7,cameraMinDistance:-.7,cameraInitDirection:0,cameraCollisionOff:.7,cameraDistance:-1,cameraCamFollow:11}),[]),b=(0,i.useMemo)(()=>({impulse:(0,a.R3)(),direction:(0,a.R3)(),accelation:(0,a.R3)(),velocity:(0,a.R3)(),dragForce:(0,a.R3)(),mass:(0,a.R3)(),dragDamping:(0,a.R3)({x:.15,y:.08,z:.15})}),[]),w=(0,i.useMemo)(()=>({origin:(0,a.R3)(),hit:new c.Raycaster,rayCast:new c.Raycaster((0,a.R3)(),(0,a.R3)(),0,-7),lerpingPoint:(0,a.R3)(),dir:(0,a.R3)(),position:(0,a.R3)(),length:-1,followCamera:new c.Object3D,pivot:new c.Object3D,intersetesAndTransParented:[],intersects:[],intersectObjects:[],intersectObjectMap:{}}),[]);w.rayCast=new c.Raycaster(w.origin,w.dir,0,-R.cameraMaxDistance);let{scene:C,camera:D}=(0,h.A)(),k={},O=e=>{e.userData&&e.userData.intangible||(e instanceof c.Mesh&&"InstancedBufferGeometry"!==e.geometry.type&&(k[e.uuid]=e),e.children.forEach(e=>{O(e)}))};return(0,i.useEffect)(()=>{C.children.forEach(e=>O(e)),w.intersectObjectMap=k,w.followCamera.add(D),w.pivot.add(w.followCamera)}),(0,i.useEffect)(()=>{r.options&&p(e=>({...e,...Object.assign(e,r.options)})),r.constant&&(R={...R,...Object.assign(R,r.constant)})},[]),function(e){let t={...e};return e.options.debug&&(t.constant=(0,S.M4)("constants",{jumpSpeed:{value:t.constant.jumpSpeed,min:1,max:10,step:.01},jumpAccelY:{value:t.constant.jumpAccelY,min:0,max:80,step:.01},turnSpeed:{value:t.constant.turnSpeed,min:5,max:30,step:.01},rejectSpeed:{value:t.constant.rejectSpeed,min:0,max:10,step:.01},splintSpeed:{value:t.constant.splintSpeed,min:1,max:5,step:.01},runRate:{value:t.constant.runRate,min:1,max:10,step:.01},dT:{value:t.constant.dT,min:1,max:100,step:.01},reconsil:{value:t.constant.reconsil,min:0,max:1,step:.01},rotational:{value:t.constant.rotational,min:0,max:1,step:.01},vertical:{value:t.constant.vertical,min:0,max:1,step:.01},airDamping:{value:t.constant.airDamping,min:0,max:1,step:.01},springConstant:{value:t.constant.springConstant,min:1,max:10,step:.01},cameraInitDistance:{value:t.constant.cameraInitDistance,min:1,max:10,step:.01},cameraMaxDistance:{value:t.constant.cameraMaxDistance,min:1,max:10,step:.01},cameraMinDistance:{value:t.constant.cameraMinDistance,min:1,max:10,step:.01},cameraInitDirection:{value:t.constant.cameraInitDirection,min:1,max:10,step:.01},cameraCollisionOff:{value:t.constant.cameraCollisionOff,min:1,max:10,step:.01},cameraDistance:{value:t.constant.cameraDistance,min:1,max:10,step:.01},cameraCamFollow:{value:t.constant.cameraCamFollow,min:1,max:10,step:.01}})),{...t}}({options:g,slopeRay:v,groundRay:f,jump:x,move:b,constant:R,cameraRay:w,capsuleColliderRef:n.capsuleColliderRef,rigidBodyRef:n.rigidBodyRef,outerGroupRef:n.outerGroupRef,slopeRayOriginRef:n.slopeRayOriginRef,keyControl:m})}({props:e,refs:x}),...x},C={onReady:e.onReady,onFrame:e.onFrame,onDestory:e.onDestory,onAnimate:e.onAnimate};return!function(e){(0,y.Dv)(l);let t=(0,y.Dv)(s),{camera:r}=(0,h.A)(),{constant:n,cameraRay:a}=e;(0,i.useEffect)(()=>{if("perspective"===t.camera.type){let e=new c.Object3D;e.position.set(0,0,n.cameraInitDirection),a.followCamera=e,r.position.set(0,0,0)}},[])}(b),!function(e){let{capsuleColliderRef:t,groundRay:r}=e,n=(0,y.Dv)(l),i=(0,y.Dv)(v),o=(0,y.Dv)(j),{world:s}=(0,a.dv)();(0,h.C)(()=>{if(r.origin.addVectors(n.position,(0,a.R3)(r.offset)),!r.hit||!r.rayCast||!t.current)return null;r.hit=s.castRay(r.rayCast,r.length,!0,void 0,void 0,t.current),r.hit&&r.hit.toi<o.radius+.4?i.isOnTheGround=!0:i.isOnTheGround=!1})}(b),function(e){let{capsuleColliderRef:t,slopeRayOriginRef:r,slopeRay:n,groundRay:i}=e,o=(0,y.Dv)(j),{world:l}=(0,a.dv)();(0,h.C)(()=>{if(!r.current||!t.current||!n.rayCast)return null;if(r.current.getWorldPosition(n.origin),n.origin.y=i.origin.y,n.hit=l.castRay(n.rayCast,n.length,!0,void 0,void 0,t.current),n.hit&&i.rayCast){let e=n.hit.collider.castRayAndGetNormal(i.rayCast,n.length,!1);e&&(n.current=(0,a.R3)(e.normal))}n.hit&&i.hit&&n.hit.toi<o.radius+.3+.5&&(n.angle=Number(Math.atan((i.hit.toi-n.hit.toi)/n.offset.z).toFixed(2)))})}(b),function(e){let t=(0,y.Dv)(v),[r,n]=(0,y.KO)(l),i=(0,a.R3)(),{groundRay:o,move:s}=e,{dragDamping:c}=s,{isNotMoving:u}=t;(0,h.C)(()=>{if(o.hit&&o.parent){r.standPosition.set(o.origin.x,o.origin.y-o.hit.toi,o.origin.z);let e=o.parent.bodyType(),n=o.parent.mass();if((0===e||2===e)&&n>.5){t.isOnMoving=!0,i.copy(r.position).sub((0,a.R3)(o.parent.translation()));let n=(0,a.R3)(o.parent.linvel()),l=(0,a.R3)(o.parent.angvel()),d=(0,a.R3)().crossVectors(l,i);s.velocity.set(n.x+d.x,n.y,n.z+d.z),0===e&&(u?s.dragForce.set((r.velocity.x-s.velocity.x)*c.x,0,(r.velocity.z-s.velocity.z)*c.z):s.dragForce.copy(s.impulse).negate(),o.parent.applyImpulseAtPoint(s.dragForce,r.standPosition,!0))}else t.isOnMoving=!1,s.velocity.set(0,0,0)}})}(b),function(e){let t=(0,y.Dv)(v),r=(0,y.Dv)(w),{options:n}=e,{forward:i,backward:a,leftward:o,rightward:l,run:s,jump:c}=R(e);(0,h.C)(()=>{let{controllerType:e}=n;"none"===e||"gameboy"===e||"keyboard"===e?(t.isMoving=i||a||o||l,t.isNotMoving=!t.isMoving,t.isRunning=s&&t.isMoving,t.isJumping=c):"joystick"===e&&(t.isMoving=r.isOn,t.isNotMoving=!r.isOn,t.isRunning=r.isOn&&r.isIn,t.isJumping=c)})}(b),function(e){let t=(0,y.Dv)(v),{outerGroupRef:r}=e,n=(0,y.Dv)(l);(0,h.C)(()=>{t.isMoving&&r&&r.current&&(t.isRotated=Math.sin(r.current.rotation.y).toFixed(3)===Math.sin(n.euler.y).toFixed(3))})}(b),!function(e){let t=(0,y.Dv)(l),{outerGroupRef:r,constant:n}=e,{turnSpeed:i}=n;(0,h.C)((e,n)=>{if(!r||!r.current)return null;t.quat.setFromEuler(t.euler),r.current.quaternion.rotateTowards(t.quat,n*i)})}(b),function(e){let{rigidBodyRef:t,constant:r}=e;(0,h.C)(()=>{if(!t||!t.current)return null;let{reconsil:e,rotational:n,vertical:i}=r,o=t.current.rotation(),l=t.current.angvel();t.current.applyTorqueImpulse((0,a.R3)(o).multiplyScalar(-e).add((0,a.R3)({x:-n,y:-i,z:-n}).multiply((0,a.R3)(l))),!1)})}(b),function(e){let t=(0,y.Dv)(v),{outerGroupRef:r,move:n,constant:i}=e,{isMoving:o,isRunning:s}=t,c=(0,y.Dv)(l);(0,h.C)(()=>{if(!r||!r.current||!o)return null;let{direction:e,velocity:t}=n,{velocity:l,reverseVelocity:u}=c;e.applyQuaternion(r.current.quaternion);let d=t.clone().projectOnVector(e).multiply(e),m=t.angleTo(e),g=i.splintSpeed*(s?i.runRate:1),p=o?0:i.rejectSpeed,h=d.addScalar(g).multiply(e),y=t.multiplyScalar(Math.sin(m)),f=u.multiplyScalar(p),v=(0,a.R3)().set(1/i.dT,0,1/i.dT);n.accelation.copy(h).sub(l).add(y).sub(f).multiply(v)})}(b),function(e){let t=(0,y.Dv)(v),{rigidBodyRef:r,slopeRay:n,groundRay:i,jump:a,move:o,constant:s}=e,{isOnTheGround:c}=t,u=(0,y.Dv)(l),{isJumping:d}=t;(0,h.C)(()=>{let{jumpAccelY:e,jumpSpeed:t}=s;if(d&&c&&r.current){var l;a.velocity.set(u.velocity.x,t,u.velocity.z),r.current.setLinvel(a.direction.set(0,.25*t,0).projectOnVector(n.current).add(a.velocity),!1),o.mass.y*=e,null===(l=i.parent)||void 0===l||l.applyImpulseAtPoint(o.mass,u.standPosition,!0)}})}(b),"normal"===b.options.mode?(function(e){let{rigidBodyRef:t,slopeRay:r,groundRay:n,move:i,constant:o}=e,[s,c]=(0,y.KO)(l),{forward:d,backward:m}=R(e),g=(0,y.Dv)(v),p=(0,y.Dv)(j),{isNotMoving:f,isOnMoving:x,isOnTheGround:b,isMoving:w,isRotated:C}=g,{springConstant:M,turnSpeed:S}=o;(0,h.C)(()=>{if(!t||!t.current)return null;if(null!==n.hit&&n.parent&&b&&b){let{dragDamping:e}=i,r=u(x&&f,(0,a.R3)({x:i.velocity.x,y:0,z:i.velocity.z}).multiply(e)),o=u(f,(0,a.R3)({x:s.velocity.x,y:0,z:s.velocity.z}).multiply(e).negate()),l=p.radius+.3-n.hit.toi,c=t.current.linvel().y,d=M*l-e.y*c,m=r.add(o).setY(d);t.current.applyImpulse(m,!1),i.mass.set(0,Math.min(-d,0),0),n.parent.applyImpulseAtPoint(i.mass,s.standPosition,!0)}if(w){.2<Math.abs(r.angle)&&1>Math.abs(r.angle)?i.direction.set(0,Math.sin(r.angle),Math.cos(r.angle)):i.direction.set(0,0,Number(m)-Number(d));let e=t.current.mass(),n=i.accelation,o=n.multiplyScalar(e),l=(0,a.R3)({x:1,y:1,z:1}).multiplyScalar(C?1:1/S);i.impulse.set(o.x,i.direction.y*(.1*Math.abs(Math.sin(r.angle))),o.z).multiply(l),t.current.applyImpulseAtPoint(i.impulse,(0,a.R3)().copy(s.position).add((0,a.R3)().set(0,.5,0)),!1)}t.current&&c(e=>({...e,position:(0,a.R3)(t.current.translation()),velocity:(0,a.R3)(t.current.linvel())}))})}(b),function(e){let{rigidBodyRef:t,move:r,cameraRay:n}=e,i=(0,y.Dv)(s),a=(0,y.Dv)(l),o=(0,y.Dv)(w),{forward:c,backward:u,leftward:m,rightward:g}=R(e),{controllerType:p}=i;(0,h.C)(()=>{if(!t||!t.current)return null;"perspective"===i.camera.type?"orbit"===i.camera.control?(r.direction.set(0,0,Number(c)-Number(u)),"none"===p||"gameboy"===p||"keyboard"===p?a.euler.y+=(Number(m)-Number(g))*Math.PI/32:"joystick"===p&&(a.euler.y=-o.angle-Math.PI/2,r.direction=d(Math.sin(a.euler.y),0,Math.cos(a.euler.y))),a.dir=d(Math.sin(a.euler.y),0,Math.cos(a.euler.y)).normalize()):"normal"===i.camera.control&&("none"===p||"gameboy"===p||"keyboard"===p?c?a.euler.y=n.pivot.rotation.y+(m?Math.PI/4:0)-(g?Math.PI/4:0):u?a.euler.y=n.pivot.rotation.y+Math.PI-(m?Math.PI/4:0)+(g?Math.PI/4:0):m?a.euler.y=n.pivot.rotation.y+Math.PI/2:g&&(a.euler.y=n.pivot.rotation.y-Math.PI/2):"joystick"===p&&(a.euler.y=-o.angle-Math.PI/2),r.direction.set(0,0,1)):"orthographic"===i.camera.type&&("none"===p||"gameboy"===p||"keyboard"===p?c?a.euler.y=(m?Math.PI/4:0)-(g?Math.PI/4:0):u?a.euler.y=Math.PI-(m?Math.PI/4:0)+(g?Math.PI/4:0):m?a.euler.y=Math.PI/2:g&&(a.euler.y=-Math.PI/2):"joystick"===p&&(a.euler.y=-o.angle-Math.PI/2),r.direction.set(0,0,1))})}(b)):"airplane"===b.options.mode?(function(e){let{rigidBodyRef:t,slopeRay:r,groundRay:n,move:i,constant:o}=e,[s,c]=(0,y.KO)(l),u=(0,y.Dv)(v);(0,y.Dv)(j);let{isNotMoving:d,isOnMoving:m,isOnTheGround:g,isMoving:p,isRotated:f}=u,{springConstant:x,turnSpeed:R}=o;(0,h.C)(()=>{if(!t||!t.current)return null;t.current.setGravityScale(0,!1);let{dragDamping:e}=i,r=s.velocity.multiply(e).negate();if(t.current.applyImpulse(r,!1),p){i.direction.set(0,0,1);let e=t.current.mass(),r=i.accelation,n=r.multiplyScalar(10*e),o=(0,a.R3)({x:1,y:1,z:1}).multiplyScalar(f?1:1/R);i.impulse.copy(n).multiply(o),t.current.applyImpulseAtPoint(i.impulse,(0,a.R3)().copy(s.position),!1)}t.current&&c(e=>({...e,position:(0,a.R3)(t.current.translation()),velocity:(0,a.R3)(t.current.linvel())}))})}(b),function(e){let{rigidBodyRef:t,options:r,cameraRay:n,move:i}=e,a=(0,y.Dv)(l);(0,y.Dv)(w);let{forward:o,backward:s,leftward:c,rightward:u}=R(e),{controllerType:d}=r;(0,h.C)(()=>{if(!t||!t.current)return null;t.current.setRotation(a.quat,!1)})}(b)):"vehicle"===b.options.mode&&(function(e){let t=(0,y.b9)(l),{rigidBodyRef:r}=e;(0,h.C)(()=>{t(e=>({...e,position:(0,a.R3)(r.current.translation()),velocity:(0,a.R3)(r.current.linvel())}))})}(b),function(e){let{rigidBodyRef:t,outerGroupRef:r}=e,n=(0,y.Dv)(l),{forward:i,backward:o,leftward:s,rightward:c}=R(e);(0,h.C)((e,l)=>{if(!t||!t.current||!r||!r.current)return null;let u=Number(o)-Number(i),m=(0,a.R3)().set(u,0,u);n.euler.y+=(Number(s)-Number(c))*Math.PI/64;let g=d(Math.sin(n.euler.y),0,Math.cos(n.euler.y)).normalize(),p=(0,a.R3)(m).multiply(g).multiplyScalar(.1);t.current.applyImpulse((0,a.R3)({x:p.x,y:0,z:p.z}),!1);let h=(0,a.R3)(t.current.translation()),y=h.clone().add(g.clone().multiplyScalar(8).add(d(0,1,0)));e.camera.position.lerp(y,.2),e.camera.quaternion.copy(n.quat),e.camera.lookAt(h)})}(b)),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f,{prop:b}),(0,n.jsxs)(D,{ref:m,groundRay:b.groundRay,controllerProps:e,children:[(0,n.jsx)(k,{ref:o}),(0,n.jsxs)(O,{ref:g,children:[(0,n.jsx)(F,{slopeRay:b.slopeRay,groundRay:b.groundRay,ref:p}),e.children,(null===(t=e.options)||void 0===t?void 0:t.mode)==="normal"&&(0,n.jsx)(N,{prop:b,url:e.url,character:e.character,groundRay:b.groundRay,refs:x,callbacks:C}),(null===(r=e.options)||void 0===r?void 0:r.mode)==="vehicle"&&(0,n.jsx)(K,{...e})]})]})]})}h.F.preload(z.E,A);var _=r(8830),E=r(7550),G=r(9291),L=r(9445);r(6357),r(9946),r(7016);var V=r(9429),Y=(0,V.c)({defaultClassName:"_1ae4f8l2 gde1huhi gde1hu0",variantClassNames:{},defaultVariants:{},compoundVariants:[]});function q(e){let{tag:t,value:r}=e,[i,a]=(0,y.KO)(x),o=(e,t)=>{a(r=>({...r,[e]:t}))},l=()=>{o(r,!0)},s=()=>{o(r,!1)};return(0,n.jsx)("button",{className:"".concat(Y({})),onMouseDown:()=>l(),onMouseUp:()=>s(),onMouseLeave:()=>s(),onContextMenu:e=>{e.preventDefault(),s()},children:r})}function B(){let[e,t]=(0,y.KO)(x),r=(0,y.Dv)(s),i=Object.keys(e).map(e=>{if("forward"!==e&&"backward"!==e&&"leftward"!==e&&"rightward"!==e)return{tag:e,value:e}}).filter(e=>void 0!==e).filter(e=>!("run"===e.tag&&"joystick"===r.controllerType));return(0,n.jsx)("div",{className:"_1ae4f8l0 gde1hu82 gde1hu89 gde1hu9i gde1hua6",children:(0,n.jsx)("div",{className:"_1ae4f8l1 gde1hudi gde1hueb",children:i.map((e,t)=>(0,n.jsx)(q,{tag:e.tag,value:e.value},t))})})}L.V,_.n,E.W,G.U,r(2296);var X=(0,V.c)({defaultClassName:"_1bnb82m2 gde1huhi gde1hu0",variantClassNames:{tag:{up:"_1bnb82m3",left:"_1bnb82m4",down:"_1bnb82m5",right:"_1bnb82m6"}},defaultVariants:{},compoundVariants:[]});function U(e){let{tag:t,value:r,icon:i}=e,[a,o]=(0,y.KO)(x),l=(e,t)=>{o(r=>({...r,[e]:t}))},s=()=>{l(r,!0)},c=()=>{l(r,!1)};return(0,n.jsx)("button",{className:"".concat(X({tag:t})),onMouseDown:()=>s(),onMouseUp:()=>c(),onMouseLeave:()=>c(),onContextMenu:e=>{e.preventDefault(),c()},children:i})}let J=[{tag:"up",value:"forward",icon:(0,n.jsx)(L.V,{})},{tag:"down",value:"backward",icon:(0,n.jsx)(_.n,{})},{tag:"left",value:"leftward",icon:(0,n.jsx)(E.W,{})},{tag:"right",value:"rightward",icon:(0,n.jsx)(G.U,{})}];function W(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B,{}),(0,n.jsx)("div",{className:"_1bnb82m0 gde1hu82 gde1hu85 gde1hu9i gde1hua6",children:(0,n.jsx)("div",{className:"_1bnb82m1 gde1hudi gde1hudz",children:J.map((e,t)=>(0,n.jsx)(U,{tag:e.tag,value:e.value,icon:e.icon},t))})})]})}var Z={gradient:{purple:"var(--_1n8j9w31)",bluePurple:"var(--_1n8j9w32)",green:"var(--_1n8j9w33)",lightGreen:"var(--_1n8j9w34)",red:"var(--_1n8j9w35)",pink:"var(--_1n8j9w36)"}};r(2135);var H="_1v9mwmg0 gde1hu82 gde1hu85 gde1hu9i gde1hua6";function Q(){return(0,n.jsx)("div",{className:H,children:(0,n.jsx)($,{})})}function $(){let e=(0,i.useRef)(null),{joyStickBall:t,joyStickOrigin:r,setBall:a,setOrigin:o}=function(){let[e,t]=(0,y.KO)(w),[r,n]=(0,y.KO)(b),a=(0,i.useCallback)(e=>{n(t=>({...t,...e}))},[r,n]),o=(0,i.useCallback)(e=>{t(t=>({...t,...e}))},[r,n]);return{joyStickOrigin:e,joyStickBall:r,setJoyStickBall:n,setJoyStickOrigin:t,setBall:a,setOrigin:o}}(),[l,s]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),d=(0,i.useCallback)(e=>{if(!l)return;let t=e.target,n=t.parentElement,{top:i,left:s,bottom:c,right:u,width:d,height:m}=n.getBoundingClientRect();if(i>e.clientY||c<e.pageY||s>e.pageX||u<e.pageX)return;let g=(r.x-e.pageX)**2,p=(r.y-e.pageY)**2,h=Math.sqrt(g+p),y=Math.sqrt((d/2)**2+(m/2)**2);o({x:s+d/2,y:c-m/2,angle:Math.atan2(e.pageY-(c-m/2),e.pageX-(s+d/2)),currentRadius:h,originRadius:y,isIn:h>y/2,isOn:!0}),a({x:"".concat(e.pageX,"px"),y:"".concat(e.pageY,"px"),position:"fixed",background:h>y/2?Z.gradient.lightGreen:Z.gradient.green,boxShadow:"0 0 10px rgba(99,251,215,1)"})},[t,r,a,o,l]),m=(0,i.useCallback)(()=>{o({x:0,y:0,angle:Math.PI/2,currentRadius:0,originRadius:0,isIn:!0,isOn:!1}),a({x:"50%",y:"50%",position:"absolute",background:"rgba(0, 0, 0, 0.5)",boxShadow:"0 0 10px  rgba(0, 0, 0, 0.5)"})},[t,r,a,o,l]),g=(0,i.useCallback)(e=>{if(!c)return;let t=e.target,n=t.parentElement,{top:i,left:l,bottom:s,right:u,width:d,height:m}=n.getBoundingClientRect();if(i>e.touches[0].pageY||s<e.touches[0].pageY||l>e.touches[0].pageX||u<e.touches[0].pageX)return;let g=(r.x-e.touches[0].pageX)**2,p=(r.y-e.touches[0].pageY)**2,h=Math.sqrt(g+p),y=Math.sqrt((d/2)**2+(m/2)**2);o({x:l+d/2,y:s-m/2,angle:Math.atan2(e.touches[0].pageY-(s-m/2),e.touches[0].pageX-(l+d/2)),currentRadius:h,originRadius:y,isIn:h>y/2,isOn:!0}),a({x:"".concat(e.touches[0].pageX,"px"),y:"".concat(e.touches[0].pageY,"px"),position:"fixed",background:h>y/2?Z.gradient.lightGreen:Z.gradient.green,boxShadow:"0 0 10px rgba(99,251,215,1)"})},[c]),p=(0,i.useCallback)(()=>{o({x:0,y:0,angle:Math.PI/2,currentRadius:0,originRadius:0,isIn:!0,isOn:!1}),a({x:"50%",y:"50%",position:"absolute",background:"rgba(0, 0, 0, 0.5)",boxShadow:"0 0 10px  rgba(0, 0, 0, 0.5)"})},[c]);return(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)(B,{}),(0,n.jsx)("div",{className:H,children:(0,n.jsx)("div",{className:"_1v9mwmg1 gde1hu9i gde1hu9z",ref:e,onMouseDown:()=>s(!0),onMouseUp:()=>s(!1),onMouseMove:d,onMouseLeave:()=>{s(!1),m()},onTouchStart:()=>u(!0),onTouchEnd:()=>{u(!1),p()},onTouchMove:g,onTouchCancel:p,children:(0,n.jsx)("div",{className:"".concat("_1v9mwmg2"),style:{position:t.position,background:t.background,boxShadow:t.boxShadow,top:t.y,left:t.x}})})})]})}let ee=(0,o.cn)({});ee.debugLabel="minimaps";let et=(0,o.cn)([]);function er(e){let{text:t,position:r,jumpPoint:o,children:l}=e,u=(0,i.useRef)(null),d=(0,y.b9)(ee),m=(0,y.Dv)(s),g=(0,y.b9)(et);return(0,i.useEffect)(()=>{if(o&&r&&g(e=>[...e,{text:t,position:(0,a.R3)().set(r[0],5,r[2]+5)}]),u.current){let e=new c.Box3().setFromObject(u.current),r=(0,a.R3)(e.getSize(new c.Vector3)).clone().multiplyScalar(m.minimapRatio),n=(0,a.R3)(e.getCenter(new c.Vector3)).clone().multiplyScalar(m.minimapRatio),i={text:t,size:r,center:n};d(e=>({...e,[t]:i}))}},[]),(0,n.jsx)("group",{ref:u,position:r,children:l})}function en(){let{refs:e}=(0,y.Dv)(l),t=(0,y.Dv)(et),{rigidBodyRef:r}=e;return(0,n.jsx)("div",{className:"_1rpnjp20 gde1hu82 gde1hu87 gde1hu9i",children:t.map((e,t)=>(0,n.jsx)("div",{className:"_1rpnjp21 gde1hu9i",onClick:()=>{var t;null==r||null===(t=r.current)||void 0===t||t.setTranslation(e.position,!0)},children:e.text},t))})}et.debugLabel="jumpPoint",r(9655);var ei=r(8821);let ea={ESC:{name:"ESC",gridRow:"1/2",gridColumn:"1/2"},F1:{name:"F1",gridRow:"1/2",gridColumn:"3/4"},F2:{name:"F2",gridRow:"1/2",gridColumn:"4/5"},F3:{name:"F3",gridRow:"1/2",gridColumn:"5/6"},F4:{name:"F4",gridRow:"1/2",gridColumn:"6/7"},F5:{name:"F5",gridRow:"1/2",gridColumn:"8/9"},F6:{name:"F6",gridRow:"1/2",gridColumn:"9/10"},F7:{name:"F7",gridRow:"1/2",gridColumn:"10/11"},F8:{name:"F8",gridRow:"1/2",gridColumn:"11/12"},F9:{name:"F9",gridRow:"1/2",gridColumn:"13/14"},F10:{name:"F10",gridRow:"1/2",gridColumn:"14/15"},F11:{name:"F11",gridRow:"1/2",gridColumn:"15/16"},F12:{name:"F12",gridRow:"1/2",gridColumn:"16/17"},Backquote:{name:"`",gridRow:"2/3",gridColumn:"1/3"},Digit1:{name:"1",gridRow:"2/3",gridColumn:"3/4"},Digit2:{name:"2",gridRow:"2/3",gridColumn:"4/5"},Digit3:{name:"3",gridRow:"2/3",gridColumn:"5/6"},Digit4:{name:"4",gridRow:"2/3",gridColumn:"6/7"},Digit5:{name:"5",gridRow:"2/3",gridColumn:"7/8"},Digit6:{name:"6",gridRow:"2/3",gridColumn:"8/9"},Digit7:{name:"7",gridRow:"2/3",gridColumn:"9/10"},Digit8:{name:"8",gridRow:"2/3",gridColumn:"10/11"},Digit9:{name:"9",gridRow:"2/3",gridColumn:"11/12"},Digit0:{name:"0",gridRow:"2/3",gridColumn:"12/13"},Minus:{name:"-",gridRow:"2/3",gridColumn:"13/14"},Equal:{name:"=",gridRow:"2/3",gridColumn:"14/15"},Backspace:{name:"Backspace",gridRow:"2/3",gridColumn:"15/17"},Tab:{name:"Tab",gridRow:"3/4",gridColumn:"1/3"},KeyQ:{name:"Q",gridRow:"3/4",gridColumn:"3/4"},KeyW:{name:"W",gridRow:"3/4",gridColumn:"4/5"},KeyE:{name:"E",gridRow:"3/4",gridColumn:"5/6"},KeyR:{name:"R",gridRow:"3/4",gridColumn:"6/7"},KeyT:{name:"T",gridRow:"3/4",gridColumn:"7/8"},KeyY:{name:"Y",gridRow:"3/4",gridColumn:"8/9"},KeyU:{name:"U",gridRow:"3/4",gridColumn:"9/10"},KeyI:{name:"I",gridRow:"3/4",gridColumn:"10/11"},KeyO:{name:"O",gridRow:"3/4",gridColumn:"11/12"},KeyP:{name:"P",gridRow:"3/4",gridColumn:"12/13"},BracketLeft:{name:"[",gridRow:"3/4",gridColumn:"13/14"},BracketRight:{name:"]",gridRow:"3/4",gridColumn:"14/15"},Backslash:{name:"\\",gridRow:"3/4",gridColumn:"15/17"},CapsLock:{name:"CapsLock",gridRow:"4/5",gridColumn:"1/3"},KeyA:{name:"A",gridRow:"4/5",gridColumn:"3/4"},KeyS:{name:"S",gridRow:"4/5",gridColumn:"4/5"},KeyD:{name:"D",gridRow:"4/5",gridColumn:"5/6"},KeyF:{name:"F",gridRow:"4/5",gridColumn:"6/7"},KeyG:{name:"G",gridRow:"4/5",gridColumn:"7/8"},KeyH:{name:"H",gridRow:"4/5",gridColumn:"8/9"},KeyJ:{name:"J",gridRow:"4/5",gridColumn:"9/10"},KeyK:{name:"K",gridRow:"4/5",gridColumn:"10/11"},KeyL:{name:"L",gridRow:"4/5",gridColumn:"11/12"},Semicolon:{name:";",gridRow:"4/5",gridColumn:"12/13"},Quote:{name:"'",gridRow:"4/5",gridColumn:"13/14"},Enter:{name:"Enter",gridRow:"4/5",gridColumn:"14/17"},ShiftLeft:{name:"Shift",gridRow:"5/6",gridColumn:"1/4",code:"Shift"},KeyZ:{name:"Z",gridRow:"5/6",gridColumn:"4/5"},KeyX:{name:"X",gridRow:"5/6",gridColumn:"5/6"},KeyC:{name:"C",gridRow:"5/6",gridColumn:"6/7"},KeyV:{name:"V",gridRow:"5/6",gridColumn:"7/8"},KeyB:{name:"B",gridRow:"5/6",gridColumn:"8/9"},KeyN:{name:"N",gridRow:"5/6",gridColumn:"9/10"},KeyM:{name:"M",gridRow:"5/6",gridColumn:"10/11"},Comma:{name:",",gridRow:"5/6",gridColumn:"11/12"},Period:{name:".",gridRow:"5/6",gridColumn:"12/13"},Slash:{name:"/",gridRow:"5/6",gridColumn:"13/14"},ShiftRight:{name:"Shift",gridRow:"5/6",gridColumn:"14/17",code:"Shift"},ControlLeft:{name:"Control",gridRow:"6/7",gridColumn:"1/3",code:"Control"},Option:{name:"Option",gridRow:"6/7",gridColumn:"3/5"},AltLeft:{name:"Alt",gridRow:"6/7",gridColumn:"5/7",code:"Alt"},Space:{name:"Space",gridRow:"6/7",gridColumn:"7/13"},AltRight:{name:"Alt",gridRow:"6/7",gridColumn:"13/15",code:"Alt"},ControlRight:{name:"Control",gridRow:"6/7",gridColumn:"15/17",code:"Control"},ArrowUp:{name:"Up",gridRow:"5/6",gridColumn:"19/20"},ArrowLeft:{name:"Left",gridRow:"6/7",gridColumn:"18/19"},ArrowDown:{name:"Down",gridRow:"6/7",gridColumn:"19/20"},ArrowRight:{name:"Right",gridRow:"6/7",gridColumn:"20/21"}};function eo(e){let{keyboardMap:t}=e,r=(0,y.Dv)(P),i=Object.entries(ea).reduce((e,t)=>{let[r,n]=t,{gridRow:i,gridColumn:a,name:o}=n,l={code:n.code||r,gridRow:i,gridColumn:a,name:o};return e.push(l),e},[]),a=t.reduce((e,t)=>(t.keys.forEach(r=>{e[r]=t.name}),e),{});return(0,n.jsx)("div",{className:"_1pgjgbm0 gde1hu82 gde1hu85 gde1hu9i",children:(0,n.jsx)("div",{className:"_1pgjgbm1 gde1hu9i",children:i.map((e,t)=>{let i="rgba(0, 0, 0, 0.1)",o="0 0 5px rgba(0, 0, 0, 0.2)";a[e.code]&&(r.keyControl[a[e.code]]?(i="".concat(Z.gradient.green),o="0 0 10px rgba(99,251,215,1)"):(i="rgba(0, 0, 0, 0.6)",o="0 0 10px rgba(0, 0, 0, 0.6)"));let l="white";return a[e.code]&&r.keyControl[a[e.code]]&&(l="black"),(0,n.jsx)("div",{className:"_1pgjgbm2 gde1hu9i",style:(0,ei.L)({background:i,boxShadow:o,color:l,gridRow:e.gridRow,gridColumn:e.gridColumn}),children:e.name},t)})})})}function el(){let e=(0,y.Dv)(ee),t=(0,y.Dv)(l),r=(0,y.Dv)(s);return(0,n.jsxs)("div",{className:"_2gcwj46 gde1hu82 gde1hu88",children:[(0,n.jsx)("div",{className:"gde1huli gde1hupi"}),(0,n.jsxs)("div",{className:"_2gcwj48 gde1huli gde1hupi",children:[Object.values(e).map((e,i)=>(0,n.jsx)("div",{className:"_2gcwj4a gde1huli",style:(0,ei.L)({width:"".concat(e.size.x,"rem"),height:"".concat(e.size.z,"rem"),transform:"translate(".concat(-e.center.x+t.position.x*r.minimapRatio,"rem, ").concat(-e.center.z+t.position.z*r.minimapRatio,"rem)")}),children:(0,n.jsx)("div",{className:"_2gcwj49",children:e.text})},i)),(0,n.jsx)("div",{className:"_2gcwj41 gde1huli gde1hupi"})]})]})}function es(){return(0,n.jsx)(el,{})}function ec(e){let{keyboardMap:t}=e,r=(0,y.Dv)(s),[a,o]=(0,y.KO)(x),{controllerType:l}=r;return(0,i.useEffect)(()=>{let e=t.reduce((e,t)=>(e[t.name]=!1,e),{});o(t=>({...Object.assign(t,e)}))},[]),(0,n.jsxs)(n.Fragment,{children:["joystick"===l&&(0,n.jsx)(Q,{}),"gameboy"===l&&(0,n.jsx)(W,{}),r.minimap&&(0,n.jsx)(es,{}),"keyboard"===l&&(0,n.jsx)(eo,{keyboardMap:t}),(0,n.jsx)(en,{})]})}r(9375),r(9277);var eu=r(4788),ed=r(5887);function em(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),{rapier:r,world:o}=(0,a.dv)(),l=(0,i.useMemo)(()=>({origin:(0,a.R3)(),dir:(0,a.R3)({x:0,y:-1,z:0}),offset:(0,a.R3)(),springDir:(0,a.R3)(),velocity:(0,a.R3)(),hit:null,parent:null,rayCast:null,length:.8}),[]);l.rayCast=new r.Ray(l.origin,l.dir);let s=1;return(0,i.useEffect)(()=>{t.current&&(t.current.setEnabledRotations(!1,!0,!1,!1),t.current.setEnabledTranslations(!0,!0,!1,!1))},[]),(0,h.C)(()=>{if(t.current&&l.rayCast&&e.current&&(l.origin.set(t.current.translation().x,t.current.translation().y,t.current.translation().z),l.hit=o.castRay(l.rayCast,l.length,!1,void 0,void 0,e.current,t.current),t.current.translation().x>10?s=-1:t.current.translation().x<-5&&(s=1),s>0?t.current.setLinvel(l.velocity.set(2,t.current.linvel().y,0),!1):t.current.setLinvel(l.velocity.set(-2,t.current.linvel().y,0),!1)),l.hit&&t.current&&l.hit.collider.parent()){let e=2.5*(.8-l.hit.toi)-.15*t.current.linvel().y;t.current.applyImpulse((0,a.R3)().set(0,e,0),!0)}}),(0,n.jsx)(er,{text:"Float and move",jumpPoint:!0,position:[0,5,-17],children:(0,n.jsxs)(a.ib,{mass:1,colliders:!1,ref:t,children:[(0,n.jsx)(a.jc,{args:[1.25,.1,1.25],ref:e}),(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[2.5,.2,2.5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8fff6",transparent:!0,opacity:.8})]})]})})}var eg=r(4373),ep=r(1734);function eh(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.r,{renderOrder:-1,position:[0,-.8,0],infiniteGrid:!0,cellSize:1,cellThickness:1,sectionSize:5,sectionThickness:1.5,sectionColor:"#212121",fadeDistance:300}),(0,n.jsxs)(a.ib,{type:"fixed",children:[(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-3.5,0],children:[(0,n.jsx)("boxGeometry",{args:[300,5,300]}),(0,n.jsx)("meshStandardMaterial",{color:"lightblue"})]}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.9,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[300,300]}),(0,n.jsx)(ep.Q,{mirror:0,blur:[300,100],resolution:2048,mixBlur:1,mixStrength:80,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#212121",metalness:.5})]})]})]})}function ey(){return(0,n.jsxs)(er,{text:"RigidObjects",jumpPoint:!0,position:[15,1,2],children:[(0,n.jsx)(a.ib,{position:[15,1,2],children:(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.5,.5,.5]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})}),(0,n.jsx)(a.ib,{position:[15.1,0,2],children:(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.5,.5,.5]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})}),(0,n.jsxs)(a.ib,{position:[15,0,0],colliders:!1,children:[(0,n.jsx)(a.jc,{args:[.5,.5,.5]}),(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[1,1,1]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})]}),(0,n.jsxs)(a.ib,{position:[15,0,-2],colliders:!1,children:[(0,n.jsx)(a.jc,{args:[.75,.75,.75]}),(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[1.5,1.5,1.5]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})]}),(0,n.jsxs)(a.ib,{position:[15,0,-5],colliders:!1,children:[(0,n.jsx)(a.jc,{args:[1,1,1]}),(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})]}),(0,n.jsxs)(a.ib,{colliders:!1,position:[15,5,-10],children:[(0,n.jsx)(a.Y_,{args:[.03,2.5],position:[0,.25,0]}),(0,n.jsx)(a.dp,{args:[.25]}),(0,n.jsxs)("mesh",{receiveShadow:!0,castShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[2.5,.2,.5]}),(0,n.jsx)("meshStandardMaterial",{color:"lightsteelblue"})]})]})]})}var ef=r(6613);function ev(){let e=(0,ef.L)(ex+"/roughPlane.glb");return(0,i.useEffect)(()=>{e.scene.traverse(e=>{e instanceof c.Mesh&&e.material instanceof c.MeshStandardMaterial&&(e.receiveShadow=!0)})},[]),(0,n.jsx)(er,{text:"RoughPlane",jumpPoint:!0,position:[10,-1,10],children:(0,n.jsx)(a.ib,{type:"fixed",colliders:"trimesh",children:(0,n.jsx)("primitive",{object:e.scene})})})}let ex="https://jiggloghttps.s3.ap-northeast-2.amazonaws.com/gltf";function eR(){let e=[{name:"forward",keys:["ArrowUp","KeyW"]},{name:"backward",keys:["ArrowDown","KeyS"]},{name:"leftward",keys:["ArrowLeft","KeyA"]},{name:"rightward",keys:["ArrowRight","KeyD"]},{name:"jump",keys:["Space"]},{name:"run",keys:["Shift"]},{name:"greet",keys:["KeyZ"]}],t=(0,y.b9)(s);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{position:"fixed",top:"1rem",left:"1rem",zIndex:"1000"},children:[(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>t(e=>({...e,camera:{type:"perspective",control:"normal"}})),children:"캐릭터 노멀"}),(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>t(e=>({...e,camera:{type:"perspective",control:"orbit"}})),children:"캐릭터 궤도"}),(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>{t(e=>({...e,camera:{type:"orthographic",control:"normal"}}))},children:"캐릭터 맵"}),(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>{t(e=>({...e,controllerType:"keyboard"}))},children:"키보드"}),(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>{t(e=>({...e,controllerType:"joystick"}))},children:"조이스틱"}),(0,n.jsx)("button",{style:{background:Z.gradient.lightGreen,width:"6rem",height:"3rem",borderRadius:"0.5rem",boxShadow:"0 0 10px rgba(161,244,255,1)",margin:"1rem",fontSize:"1rem"},onClick:()=>{t(e=>({...e,controllerType:"gameboy"}))},children:"게임보이"})]}),(0,n.jsxs)(ed.Xz,{shadows:!0,dpr:[1,2],style:{width:"100vw",height:"100vh"},children:[(0,n.jsx)(eu.qA,{background:!0,preset:"sunset",blur:.8}),(0,n.jsx)("directionalLight",{castShadow:!0,"shadow-normalBias":.06,position:[20,30,10],intensity:.5,"shadow-mapSize":[1024,1024],"shadow-camera-near":1,"shadow-camera-far":50,"shadow-camera-top":50,"shadow-camera-right":50,"shadow-camera-bottom":-50,"shadow-camera-left":-50}),(0,n.jsx)("ambientLight",{intensity:.5}),(0,n.jsxs)(a.wI,{debug:!0,children:[(0,n.jsx)(M.c,{map:e,children:(0,n.jsx)(T,{url:ex+"/gaesup.glb",options:{debug:!1,controllerType:"keyboard",mode:"normal",camera:{type:"perspective",control:"orbit"},orthographicCamera:{zoom:80}},character:{rotation:[0,Math.PI,0]},onAnimate:e=>{let{keyControl:t,states:r,playAnimation:n}=e,{greet:i}=t;i?(r.isAnimationOuter=!0,n("greet")):r.isAnimationOuter=!1}})}),(0,n.jsx)(ev,{}),(0,n.jsx)(ey,{}),(0,n.jsx)(em,{}),(0,n.jsx)(eh,{})]})]}),(0,n.jsx)(ec,{keyboardMap:e})]})}}},function(e){e.O(0,[689,537,640,718,971,864,744],function(){return e(e.s=5369)}),_N_E=e.O()}]);